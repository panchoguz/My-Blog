[
  {
    "path": "posts/2021-04-08-evolucin-del-precio-del-cobre/",
    "title": "Evolución precio del cobre",
    "description": "El siguiente post...",
    "author": [
      {
        "name": "Francisco Guzmán",
        "url": "https://example.com/panguz"
      }
    ],
    "date": "2021-04-09",
    "categories": [
      "ggplot2",
      "Cobre"
    ],
    "contents": "\r\n\r\nContents\r\nResultado esperado\r\nPaso a paso\r\nBase de datos\r\nLibrerías\r\nImportamos base\r\nGráfico\r\nggplot()/geom_line()\r\nlabs()\r\ntheme_minimal()\r\ntheme()\r\nannotate()\r\ngeom_point()/geom_text()\r\nannotate()\r\ngeom_hline()/geom_text\r\n\r\n\r\nCódigo gráfico\r\nReferencias\r\n\r\n\r\nbody {\r\ntext-align: justify}\r\nResultado esperado\r\n\r\n\r\n\r\nPaso a paso\r\nBase de datos\r\nDebemos ir a Precios de los Metales e Inventarios y descargar los datos. En este caso, trabajaremos con el precio mensual del período Ene2000-Mar2021 (LME).\r\nLibrerías\r\nDeben haber sido previamente instaladas con el comando install.packages().\r\n\r\n\r\nlibrary(readxl)\r\nlibrary(ggplot2)\r\nlibrary(tidyverse)\r\n\r\n\r\n\r\n\r\n\r\n\r\nImportamos base\r\nDebemos fijarnos en que la base esté guardada en formato .xlsx, al decargarla puede haber quedado en algún otro formato. Luego de importar, realizamos algunas modificaciones.\r\n\r\n\r\ndf <- read_excel(\"datos.xlsx\")\r\n\r\nnames(df)[1] <- \"Fecha\"\r\nnames(df)[2] <- \"Precio\"\r\n\r\ndf$Fecha <- as.Date(df$Fecha)\r\n\r\n\r\n\r\nGráfico\r\nggplot()/geom_line()\r\nComenzamos con un gráfico simple.\r\n\r\n\r\ngraph <- ggplot(data = df, aes(Fecha, Precio)) +\r\n  geom_line(colour = \"navy\")\r\ngraph\r\n\r\n\r\n\r\n\r\nlabs()\r\nPodemos agregar título, subtítulo, entre otras cosas.\r\n\r\n\r\ngraph <- graph + labs(title = \"Precio Nominal Cobre Mensual (¢/lb)\",\r\n                     subtitle = \"Período 2000-2021\",\r\n       caption = \"Fuente: Elaboración propia en base a datos de Cochilco\",\r\n       tag = \"\",\r\n       x = \"\",\r\n       y = \"\")\r\ngraph\r\n\r\n\r\n\r\n\r\ntheme_minimal()\r\nAñadimos un tema. Ver más opciones en Complete themes.\r\n\r\n\r\ngraph <- graph + theme_minimal()\r\ngraph\r\n\r\n\r\n\r\n\r\ntheme()\r\nEditamos el tema: tamaño del título, subtítulo, fuente, margen, etc. Ver Modify components of a theme para más detalles.\r\n\r\n\r\ngraph <- graph +\r\n  theme(plot.title = element_text(size = rel(1.35)),\r\n        plot.subtitle = element_text(size = rel(1), margin=margin(0,0,20,0)),\r\n        plot.caption = element_text(hjust = 0, face= \"italic\"))\r\ngraph\r\n\r\n\r\n\r\n\r\nannotate()\r\nAgregamos un rectángulo sombreado para identificar algún período más relevante dentro del gráfico.\r\n\r\n\r\ngraph <- graph +\r\n  annotate(\"rect\", fill = \"darkgreen\", alpha = 0.2,\r\n           xmin = as.Date(\"2009-11-01\"), xmax = as.Date(\"2013-05-01\"),\r\n           ymin = -Inf, ymax = Inf)\r\ngraph\r\n\r\n\r\n\r\n\r\ngeom_point()/geom_text()\r\nPodemos identificar un punto máximo y colocar una etiqueta. Creamos graph2 porque no añadiremos esto en nuestro gráfico pirncipal.\r\n\r\n\r\npmax <- df %>% #precio máximo\r\n  slice(which.max(Precio))\r\n\r\ngraph2 <- graph +\r\n  geom_point(data = pmax, aes(x = Fecha, y = Precio), col = \"red\",\r\n             shape = 21, fill = NA, size = 4, stroke = 1.1) +\r\n  geom_text(data = pmax, aes(x = Fecha, y = Precio,\r\n                label = sprintf(\"%0.1f\", round(Precio, digits = 3))),\r\n            size = 2.5, vjust = 0, hjust = -0.5)\r\ngraph2\r\n\r\n\r\n\r\n\r\nannotate()\r\nVolvemos a utilizar graph. Añadimos un texto con información adicional sobre el período destacado. Ver Create an annotation layer para más detalles.\r\n\r\n\r\ngraph <- graph + \r\n  annotate(geom=\"text\",x=as.Date(\"2011-08-01\"),\r\n           y=490, label=\"superciclo 09'-13'\", fontface=\"plain\", size=3)\r\ngraph\r\n\r\n\r\n\r\n\r\ngeom_hline()/geom_text\r\nFinalmente, podemos agregar una línea con el valor actual del cobre (el más reciente en los datos descargados) y crear la etiqueta correspondiente.\r\n\r\n\r\nplast <- df %>% #precio más reciente\r\n  slice(which.max(Fecha))\r\n\r\ngraph <- graph +\r\n  geom_hline(yintercept = tail(df$Precio, n=1), linetype=\"dashed\",\r\n             color = \"red\", size = .5) +\r\n  geom_text(data = plast,\r\n            aes(x = Fecha, y = Precio,\r\n                label = sprintf(\"%0.1f\", round(Precio, digits = 3))), size = 3,\r\n            vjust = -.5, hjust = .5, col = \"red\")\r\ngraph\r\n\r\n\r\n\r\n\r\nCódigo gráfico\r\n\r\n\r\nplast <- df %>% #precio más reciente\r\n  slice(which.max(Fecha))\r\n\r\nggplot(data = df, aes(Fecha, Precio)) +\r\n  geom_line(colour = \"navy\")+ \r\n  labs(title = \"Precio Nominal Cobre Mensual (¢/lb)\",\r\n                      subtitle = \"Período 2000-2021\",\r\n                      caption = \"Fuente: Elaboración propia en base a datos de Cochilco\",\r\n                      tag = \"\",\r\n                      x = \"\",\r\n                      y = \"\") + \r\n  theme_minimal() +\r\n  theme(plot.title = element_text(size = rel(1.35)),\r\n        plot.subtitle = element_text(size = rel(1), margin=margin(0,0,20,0)),\r\n        plot.caption = element_text(hjust = 0, face= \"italic\")) +\r\n  annotate(\"rect\", fill = \"darkgreen\", alpha = 0.2,\r\n           xmin = as.Date(\"2009-11-01\"), xmax = as.Date(\"2013-05-01\"),\r\n           ymin = -Inf, ymax = Inf) +\r\n  annotate(geom=\"text\",x=as.Date(\"2011-08-01\"),\r\n           y=490, label=\"superciclo 09'-13'\", fontface=\"plain\", size=3) +\r\n  geom_hline(yintercept = tail(df$Precio, n=1), linetype=\"dashed\",\r\n             color = \"red\", size = .5) +\r\n  geom_text(data = plast,\r\n            aes(x = Fecha, y = Precio,\r\n                label = sprintf(\"%0.1f\", round(Precio, digits = 3))), size = 3,\r\n            vjust = -.5, hjust = .5, col = \"red\")\r\n\r\n\r\n\r\nReferencias\r\nggplot2\r\n\r\n\r\n\r\n",
    "preview": "posts/2021-04-08-evolucin-del-precio-del-cobre/distill-preview.png",
    "last_modified": "2021-04-09T11:49:05-04:00",
    "input_file": {},
    "preview_width": 1248,
    "preview_height": 768
  }
]
